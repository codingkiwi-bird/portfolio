<div class="project-detail">
    <header class="project-detail-header">
        <h1>smart-farm</h1>
    </header>
    
    <div class="project-detail-content">
        <div class="project-hero">
            <div class="project-image-large">
                <div class="slider" data-slider="smart-farm">
                    <div class="slides">
                        <div class="slide" style="background-image: url('./images/project/smart-farm/smart-farm-01.JPG');"></div>
                        <div class="slide" style="background-image: url('./images/project/smart-farm/smart-farm-02.JPG');"></div>
                    </div>
                    <button class="slider-btn prev" aria-label="이전" data-action="prev"><i class="fas fa-chevron-left"></i></button>
                    <button class="slider-btn next" aria-label="다음" data-action="next"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="project-meta">
                <h2>토양 습도 기반 자동 물주기 장치</h2>
                <p class="project-subtitle">아두이노·릴레이·펌프로 구현한 3단계 제어 로직</p>
                
                <div class="project-tags">
                    <span class="tag">Arduino</span>
                    <span class="tag">C++</span>
                    <span class="tag">IoT</span>
                </div>
            </div>
        </div>
        
        <div class="project-sections">
            <section class="project-section">
                <h3>프로젝트 개요</h3>
                <p>
                    토양 습도에 따라 자동으로 물을 주는 스마트팜 장치입니다. 아두이노로 센서 값을 읽고
                    릴레이 모듈을 통해 펌프를 제어합니다. 습함, 건조함, 그리고 센서가 토양에서 분리된 상태(비토양)로
                    총 3개의 상태를 구분하며, 건조할 때만 물을 주도록 설계했습니다.
                </p>
                <p>
                    4인 개발 프로젝트였으며, 저는 회로 구성과 배선 정리를 담당했습니다. 또한 실제 토양에서
                    센서 값을 장기간 수집해 <em>습한 정도</em>와 <em>습하지 않은 정도</em>의 임계값을 직접 측정하고
                    기준 범위를 정의했습니다.
                </p>
            </section>

            <section class="project-section">
                <h3>동작 원리</h3>
                <ul>
                    <li><strong>HUMID (습함)</strong>: 토양 수분이 충분해 펌프를 끕니다.</li>
                    <li><strong>DRY (건조함)</strong>: 토양이 건조하면 릴레이를 켜 펌프를 동작시킵니다.</li>
                    <li><strong>NON_SOIL (센서 분리)</strong>: 센서를 흙에서 뺐을 때 값이 내려가지만 토양이 아니므로 별도 상태로 처리하여 펌프를 동작하지 않습니다.</li>
                </ul>
                <p>
                    값의 흔들림을 줄이기 위해 간단한 임계값과 상태 기반 로직을 사용했습니다.
                </p>
            </section>

            <section class="project-section">
                <h3>Code (C++ on Arduino IDE)</h3>
                <div class="tech-details">
                    <div class="tech-category">
                        <pre><code>#include &lt;Wire.h&gt;
#include &lt;LiquidCrystal_I2C.h&gt; // LCD 사용을 위한 라이브러리 추가 필요

LiquidCrystal_I2C lcd(0x27,16,2);

int water; // 변수 water 습도가 얼마인지 아날로그 변수로 계산
const int POT = 0; // 습도 센서는 아날로그 0번 포트

// 상태 정의 및 상태 변경 디바운싱을 위한 변수들
enum State { STATE_MOVING, STATE_DRY, STATE_ENOUGH };
int stableState = STATE_ENOUGH;       // 현재 확정된(안정화된) 상태
int candidateState = STATE_ENOUGH;    // 바뀌려는 후보 상태
unsigned long candidateSince = 0;     // 후보 상태가 시작된 시각(ms)

void setup() {
    pinMode(3,OUTPUT); // 수중 펌프는 디지털로 작동 ON / OFF
    Serial.begin(9600); // 시리얼 넘버로 작동상태 확인
    lcd.init(); // LCD 사용을 위한 초기 선언
    lcd.backlight();
}

void loop() {
    water = analogRead(POT); // 습도 값을 읽어와 water 변수에 할당
    Serial.println(water); // 시리얼 포트에 water 값 출력

    // 현재 측정값으로 즉시 계산한 상태
    int currentState;
    if (water &gt; 910) {
        currentState = STATE_MOVING;           // 센서 이동/비토양 추정
    } else if (water &lt;= 910 &amp;&amp; water &gt;= 730) {
        currentState = STATE_DRY;              // 건조
    } else {
        currentState = STATE_ENOUGH;           // 충분히 적셔짐
    }

    // 상태 변경 디바운싱: 새로운 상태가 3초 이상 유지되어야 확정
    if (currentState != stableState) {
        if (candidateState != currentState) {
            candidateState = currentState;
            candidateSince = millis();
        } else if (millis() - candidateSince &gt;= 3000UL) {
            stableState = currentState; // 3초 유지됨 → 상태 확정
        }
    } else {
        candidateState = stableState; // 동기화
        candidateSince = millis();
    }

    // 확정된 상태에 따라 동작 수행
    if (stableState == STATE_MOVING) {
        lcd.clear();
        lcd.setCursor(0,0);
        lcd.print("Sensor Moving");
        digitalWrite(3,LOW); // 센서를 이동중이므로 물 공급 안함
    } else if (stableState == STATE_DRY) {
        lcd.clear();
        lcd.setCursor(0,0);
        lcd.print("Water Bomb"); // 수중펌프가 작동함을 LCD로 알림
        digitalWrite(3,HIGH); // 수중펌프 작동
    } else { // STATE_ENOUGH
        lcd.clear();
        lcd.setCursor(0,0);
        lcd.print("Enough"); // 적절한 습도
        digitalWrite(3,LOW); // 수중 펌프 해제
    }
    delay(400); // 수중 펌프에서 너무 많은 양의 물이 들어가지 않게 딜레이 적용
}
</code></pre>
                    </div>
                </div>
            </section>

            <section class="project-section">
                <h3>하드웨어 구성</h3>
                <div class="project-gallery grid-3">
                    <figure class="project-figure">
                        <img class="project-part-img" src="./images/project/smart-farm/part/part-sensor.jpg" alt="토양 습도 센서" />
                        <figcaption class="project-caption">토양 습도 센서</figcaption>
                    </figure>
                    <figure class="project-figure">
                        <img class="project-part-img" src="./images/project/smart-farm/part/part-relay moduel.jpg" alt="릴레이 모듈" />
                        <figcaption class="project-caption">릴레이 모듈</figcaption>
                    </figure>
                    <figure class="project-figure">
                        <img class="project-part-img" src="./images/project/smart-farm/part/part-pump.jpg" alt="워터 펌프" />
                        <figcaption class="project-caption">워터 펌프</figcaption>
                    </figure>
                    <figure class="project-figure">
                        <img class="project-part-img" src="./images/project/smart-farm/part/part-moduel.jpg" alt="토양 습도 모듈" />
                        <figcaption class="project-caption">컨트롤 모듈</figcaption>
                    </figure>
                    <figure class="project-figure">
                        <img class="project-part-img" src="./images/project/smart-farm/part/part-Uno R3.png" alt="Arduino Uno R3" />
                        <figcaption class="project-caption">Arduino Uno R3</figcaption>
                    </figure>
                    <figure class="project-figure">
                        <img class="project-part-img" src="./images/project/smart-farm/part/part-LCD.jpg" alt="LCD 모듈" />
                        <figcaption class="project-caption">LCD 모듈</figcaption>
                    </figure>
                </div>
            </section>

            <section class="project-section">
                <h3>프로젝트 결과</h3>
                <p>
                    실제 환경에서는 센서 노이즈로 값이 크게 튀고, 기준 수치도 매우 민감하게 변해 난관이 있었습니다.
                    이를 해결하기 위해 상태가 3초 이상 연속 유지될 때만 인정하는 로직으로 개선했으며,
                    센서 분리 상태를 별도로 처리해 오동작을 방지했습니다. 이 과정을 통해 하드웨어 노이즈 대응,
                    임계값 설계, 디바운싱 로직 등 임베디드 제어의 핵심 개념을 체득할 수 있었습니다.
                </p>
            </section>
        </div>
        
        <div class="project-links"></div>
    </div>
</div>
